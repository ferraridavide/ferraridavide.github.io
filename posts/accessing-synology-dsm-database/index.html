<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Accessing Synology DSM internal databases and exporting Synology Photo albums | Davide Ferrari</title><meta name=keywords content="synology,nas"><meta name=description content="One of the reasons that lead me to finally get a Synology NAS was that i needed a simple and reliable way to solve the chaotic photo situation i had going on, all of my and my family’s photos were spread over multiple hard drives and other mediums, scattered in unorganized random folders, to put it simply, they were all over the place.
I was looking for a solution that is reliable, easily maintainable, and that would allow me to neatly organize all of my photos in a single place, something that has fine-grained control over photo access permissions with a user system, and with an intuitive enough user interface that my tech-illiterate family members could have easy access to our photos."><meta name=author content><link rel=canonical href=https://ferraridavide.github.io/posts/accessing-synology-dsm-database/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://ferraridavide.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ferraridavide.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ferraridavide.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ferraridavide.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ferraridavide.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Accessing Synology DSM internal databases and exporting Synology Photo albums"><meta property="og:description" content="One of the reasons that lead me to finally get a Synology NAS was that i needed a simple and reliable way to solve the chaotic photo situation i had going on, all of my and my family’s photos were spread over multiple hard drives and other mediums, scattered in unorganized random folders, to put it simply, they were all over the place.
I was looking for a solution that is reliable, easily maintainable, and that would allow me to neatly organize all of my photos in a single place, something that has fine-grained control over photo access permissions with a user system, and with an intuitive enough user interface that my tech-illiterate family members could have easy access to our photos."><meta property="og:type" content="article"><meta property="og:url" content="https://ferraridavide.github.io/posts/accessing-synology-dsm-database/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-19T22:55:24+00:00"><meta property="article:modified_time" content="2022-11-19T22:55:24+00:00"><meta property="og:site_name" content="Davide Ferrari"><meta name=twitter:card content="summary"><meta name=twitter:title content="Accessing Synology DSM internal databases and exporting Synology Photo albums"><meta name=twitter:description content="One of the reasons that lead me to finally get a Synology NAS was that i needed a simple and reliable way to solve the chaotic photo situation i had going on, all of my and my family’s photos were spread over multiple hard drives and other mediums, scattered in unorganized random folders, to put it simply, they were all over the place.
I was looking for a solution that is reliable, easily maintainable, and that would allow me to neatly organize all of my photos in a single place, something that has fine-grained control over photo access permissions with a user system, and with an intuitive enough user interface that my tech-illiterate family members could have easy access to our photos."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ferraridavide.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Accessing Synology DSM internal databases and exporting Synology Photo albums","item":"https://ferraridavide.github.io/posts/accessing-synology-dsm-database/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Accessing Synology DSM internal databases and exporting Synology Photo albums","name":"Accessing Synology DSM internal databases and exporting Synology Photo albums","description":"One of the reasons that lead me to finally get a Synology NAS was that i needed a simple and reliable way to solve the chaotic photo situation i had going on, all of my and my family’s photos were spread over multiple hard drives and other mediums, scattered in unorganized random folders, to put it simply, they were all over the place.\nI was looking for a solution that is reliable, easily maintainable, and that would allow me to neatly organize all of my photos in a single place, something that has fine-grained control over photo access permissions with a user system, and with an intuitive enough user interface that my tech-illiterate family members could have easy access to our photos.","keywords":["synology","nas"],"articleBody":"One of the reasons that lead me to finally get a Synology NAS was that i needed a simple and reliable way to solve the chaotic photo situation i had going on, all of my and my family’s photos were spread over multiple hard drives and other mediums, scattered in unorganized random folders, to put it simply, they were all over the place.\nI was looking for a solution that is reliable, easily maintainable, and that would allow me to neatly organize all of my photos in a single place, something that has fine-grained control over photo access permissions with a user system, and with an intuitive enough user interface that my tech-illiterate family members could have easy access to our photos.\nOut of all the other options i looked at, like Plex and PhotoPrism, Synology Photo checked almost all of those boxes.\nI took all of the photos from the many hard drives i collected over the years, wrote a script to organize them in a predictable folder structure based on the photo’s metadata (i went with a simple [year]/[month]/[day] structure) and proceeded to dump them all on the NAS\nOnly one thing left to do: separate my private photos from the ones i want to share with my family’s account, i though this would be simple enough, i just organize the photos in albums and then move the albums to the desired location (user’s personal space or shared space), bam, done!\nSadly, as it turns out, the Synology Photo’s web interface and application allow you to move a selection of photos from personal space to shared space only if the selection is made from the timeline or folder view, the option is not available in the album views! Also, moving photos this way wouldn’t preserve the folder structure i made as all the files are moved to the same folder, what a bummer!\nTimeline view selection on the left, Album view selection on the right\nSo let the tinkering begin! In order to move the albums we have to gain access to the Synology Photo’s internal database, query the contents of the album, and then use a script to move the contents automatically to the desired destination\nAccessing Synology DSM internal databases Several of Synology DSM’s services, like Download Station and Synology Photo, run on PostgreSQL databases, there are two main ways to access the data stored in these databases:\nDump the whole database to file with pg_dump then copy and inspect the dump locally (for this, i suggest following this thread) Gain access to the internal PostgreSQL server running in DSM and query the database directly In this guide I’ll show you how to access the database directly, let’s begin!\nGaining access to the internal PostgreSQL server If you haven’t done so already, enable SSH on your Synology NAS by going in Control Panel → Terminal \u0026 SNMP → Terminal → Enable SSH service\nIf the firewall is enabled, make sure to open PostgreSQL default port 5432 (TCP)\nUsing the SSH terminal, add this line host all all [Your computer IP address]/32 trust to file /etc/postgresql/pg_hba.conf If your user doesn’t have the necessary permissions to perform this action, run sudo su - postgres It should look something like this:\n# TYPE DATABASE USER ADDRESS METHOD local all postgres peer map=pg_root local all all peer host all all 192.168.1.101/32 trust In /etc/postgresql/postgresql.conf, set this parameter listen_addresses = '*'\nRestart the PostgreSQL server with pg_ctl -m fast restart\nCheck for errors with tail -f /var/log/postgresql.log\nIf everything went well, you should now be able to access the PostgreSQL database with your favorite client! JetBrains DataGrip worked best for me\nExporting Synology Photo albums All that’s left to do is to query the database and extract the album’s photos, I’m going to use JetBrains DataGrip in the following steps, but any other Postgres capable client should be fairly similar\nIn the Database Explorer add a new PostgreSQL Data Source and set these parameters Host: [your Synology NAS IP address]\nAuthentication: User \u0026 Password\nUser: postgres\nPassword: [leave blank]\nDatabase: synofoto\nTest the connection and hit Apply\nIn the data source you just created, navigate to synofoto → public → tables, you’ll see the list of all the tables in the Synology Photo database\nRun this query to list every element in every album\nSELECT a.id, a.name as albumName, r.id_item, u.filename, f.name as dirName, CONCAT(f.name,'/', u.filename) as path FROM public.normal_album AS a JOIN many_item_has_many_normal_album AS r ON a.id = r.id_normal_album JOIN unit AS u ON r.id_item = u.id JOIN folder AS f ON u.id_folder = f.id; You can now export the query result to CSV file! Remember to add column headers, you will need them for your script later\nIn my case, i went for a PowerShell script that reads this CSV file and moves the photos and videos to a new destination\n$data = Import-Csv -Path \"[...]\" $basepath = \"[...]\" $dest = \"[...]\" $data.Where{$_.albumname -eq '[...]'} | ForEach-Object { $fullpath = Join-Path -Path $basepath -ChildPath $_.path Write-Output $fullpath if (Test-Path -Path $fullpath){ $destPath = Join-Path -Path $dest -ChildPath $_.path $destDirectory = Split-Path $destPath if (!(Test-Path $destDirectory)) { New-Item -ItemType Directory -Force -Path $destDirectory } Write-Output \"--\u003e $destPath\" Move-Item -Path $fullpath -Destination $destPath -WarningAction Inquire -ErrorAction Inquire } } ","wordCount":"878","inLanguage":"en","datePublished":"2022-11-19T22:55:24Z","dateModified":"2022-11-19T22:55:24Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://ferraridavide.github.io/posts/accessing-synology-dsm-database/"},"publisher":{"@type":"Organization","name":"Davide Ferrari","logo":{"@type":"ImageObject","url":"https://ferraridavide.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ferraridavide.github.io/ accesskey=h title="Davide Ferrari (Alt + H)">Davide Ferrari</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ferraridavide.github.io/posts title=Blog><span>Blog</span></a></li><li><a href=https://ferraridavide.github.io/archives title=Archive><span>Archive</span></a></li><li><a href=https://ferraridavide.github.io/skills/ title=Skills><span>Skills</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ferraridavide.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://ferraridavide.github.io/posts/>Posts</a></div><h1 class=post-title>Accessing Synology DSM internal databases and exporting Synology Photo albums</h1><div class=post-meta><span title='2022-11-19 22:55:24 +0000 UTC'>November 19, 2022</span></div></header><div class=post-content><p>One of the reasons that lead me to finally get a Synology NAS was that i needed a simple and reliable way to solve the chaotic photo situation i had going on, all of my and my family’s photos were spread over multiple hard drives and other mediums, scattered in unorganized random folders, to put it simply, they were all over the place.</p><p>I was looking for a solution that is reliable, easily maintainable, and that would allow me to neatly organize all of my photos in a single place, something that has fine-grained control over photo access permissions with a user system, and with an intuitive enough user interface that my tech-illiterate family members could have easy access to our photos.</p><p>Out of all the other options i looked at, like Plex and PhotoPrism, Synology Photo checked almost all of those boxes.</p><p>I took all of the photos from the many hard drives i collected over the years, wrote a script to organize them in a predictable folder structure based on the photo’s metadata (i went with a simple <code>[year]/[month]/[day]</code> structure) and proceeded to dump them all on the NAS</p><p>Only one thing left to do: separate my private photos from the ones i want to share with my family’s account, i though this would be simple enough, i just organize the photos in albums and then move the albums to the desired location (user’s personal space or shared space), bam, done!</p><p>Sadly, as it turns out, the Synology Photo’s web interface and application allow you to move a selection of photos from personal space to shared space <strong>only if the selection is made from the timeline or folder view, the option is not available in the album views!</strong>
Also, moving photos this way wouldn’t preserve the folder structure i made as all the files are moved to the same folder, what a bummer!</p><p><img loading=lazy src=https://raw.githubusercontent.com/ferraridavide/ferraridavide.github.io/main/content/posts/accessing-synology-dsm-database/images/menu_difference.png alt="Timeline view selection on the left, Album view selection on the right"></p><blockquote><p>Timeline view selection on the left, Album view selection on the right</p></blockquote><p>So let the tinkering begin! In order to move the albums we have to gain access to the Synology Photo’s internal database, query the contents of the album, and then use a script to move the contents automatically to the desired destination</p><h2 id=accessing-synology-dsm-internal-databases>Accessing Synology DSM internal databases<a hidden class=anchor aria-hidden=true href=#accessing-synology-dsm-internal-databases>#</a></h2><p>Several of Synology DSM’s services, like Download Station and Synology Photo, run on PostgreSQL databases, there are two main ways to access the data stored in these databases:</p><ul><li>Dump the whole database to file with <code>pg_dump</code> then copy and inspect the dump locally
(for this, i suggest following <a href=https://community.synology.com/enu/forum/1/post/148949>this thread</a>)</li><li>Gain access to the internal PostgreSQL server running in DSM and query the database directly</li></ul><p>In this guide I’ll show you how to access the database directly, let’s begin!</p><h3 id=gaining-access-to-the-internal-postgresql-server>Gaining access to the internal PostgreSQL server<a hidden class=anchor aria-hidden=true href=#gaining-access-to-the-internal-postgresql-server>#</a></h3><ol><li><p>If you haven’t done so already, enable SSH on your Synology NAS by going in Control Panel → Terminal & SNMP → Terminal → Enable SSH service</p></li><li><p>If the firewall is enabled, make sure to open PostgreSQL default port 5432 (TCP)</p></li><li><p>Using the SSH terminal, add this line <code>host all all [Your computer IP address]/32 trust</code> to file <code>/etc/postgresql/pg_hba.conf</code>
If your user doesn’t have the necessary permissions to perform this action, run <code>sudo su - postgres</code>
It should look something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># TYPE  DATABASE        USER            ADDRESS                 METHOD</span>
</span></span><span style=display:flex><span>local   all             postgres                                peer map=pg_root
</span></span><span style=display:flex><span>local   all             all                                     peer
</span></span><span style=display:flex><span>host    all             all             <span style=color:#ae81ff>192.168</span>.1.<span style=color:#ae81ff>101</span>/<span style=color:#ae81ff>32</span>        trust
</span></span></code></pre></div></li><li><p>In <code>/etc/postgresql/postgresql.conf</code>, set this parameter <code>listen_addresses = '*'</code></p></li><li><p>Restart the PostgreSQL server with <code>pg_ctl -m fast restart</code></p></li><li><p>Check for errors with <code>tail -f /var/log/postgresql.log</code></p></li></ol><p>If everything went well, you should now be able to access the PostgreSQL database with your favorite client! JetBrains DataGrip worked best for me</p><h2 id=exporting-synology-photo-albums>Exporting Synology Photo albums<a hidden class=anchor aria-hidden=true href=#exporting-synology-photo-albums>#</a></h2><p>All that’s left to do is to query the database and extract the album’s photos, I’m going to use JetBrains DataGrip in the following steps, but any other Postgres capable client should be fairly similar</p><ol><li><p>In the Database Explorer add a new PostgreSQL Data Source and set these parameters
Host: [your Synology NAS IP address]</p><p>Authentication: User & Password</p><p>User: postgres</p><p>Password: [leave blank]</p><p>Database: synofoto</p><p><img loading=lazy src=https://raw.githubusercontent.com/ferraridavide/ferraridavide.github.io/main/content/posts/accessing-synology-dsm-database/images/new_data_source.png alt>
Test the connection and hit Apply</p></li><li><p>In the data source you just created, navigate to synofoto → public → tables, you’ll see the list of all the tables in the Synology Photo database</p></li><li><p>Run this query to list every element in every album</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> a.id, a.name <span style=color:#66d9ef>as</span> albumName, r.id_item, u.filename, f.name <span style=color:#66d9ef>as</span> dirName, CONCAT(f.name,<span style=color:#e6db74>&#39;/&#39;</span>, u.filename) <span style=color:#66d9ef>as</span> path <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>public</span>.normal_album <span style=color:#66d9ef>AS</span> a
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>JOIN</span> many_item_has_many_normal_album <span style=color:#66d9ef>AS</span> r <span style=color:#66d9ef>ON</span> a.id <span style=color:#f92672>=</span> r.id_normal_album
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>JOIN</span> unit <span style=color:#66d9ef>AS</span> u <span style=color:#66d9ef>ON</span> r.id_item <span style=color:#f92672>=</span> u.id
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>JOIN</span> folder <span style=color:#66d9ef>AS</span> f <span style=color:#66d9ef>ON</span> u.id_folder <span style=color:#f92672>=</span> f.id;
</span></span></code></pre></div></li><li><p>You can now export the query result to CSV file! Remember to add column headers, you will need them for your script later</p><p><img loading=lazy src=https://raw.githubusercontent.com/ferraridavide/ferraridavide.github.io/main/content/posts/accessing-synology-dsm-database/images/exporting.png alt></p></li><li><p>In my case, i went for a PowerShell script that reads this CSV file and moves the photos and videos to a new destination</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$data = Import-Csv -Path <span style=color:#e6db74>&#34;[...]&#34;</span>
</span></span><span style=display:flex><span>$basepath = <span style=color:#e6db74>&#34;[...]&#34;</span>
</span></span><span style=display:flex><span>$dest = <span style=color:#e6db74>&#34;[...]&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$data.Where{$_.albumname <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#39;[...]&#39;</span>} | ForEach-Object {
</span></span><span style=display:flex><span>    $fullpath = Join-Path -Path $basepath -ChildPath $_.path
</span></span><span style=display:flex><span>    Write-Output $fullpath 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (Test-Path -Path $fullpath){
</span></span><span style=display:flex><span>        $destPath = Join-Path -Path $dest -ChildPath $_.path
</span></span><span style=display:flex><span>        $destDirectory = Split-Path $destPath
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (!(Test-Path $destDirectory)) {
</span></span><span style=display:flex><span>            New-Item -ItemType Directory -Force -Path $destDirectory
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Write-Output <span style=color:#e6db74>&#34;--&gt; </span>$destPath<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        Move-Item -Path $fullpath -Destination $destPath -WarningAction Inquire -ErrorAction Inquire
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://ferraridavide.github.io/tags/synology/>synology</a></li><li><a href=https://ferraridavide.github.io/tags/nas/>nas</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://ferraridavide.github.io/>Davide Ferrari</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>